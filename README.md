# SQL
Итоговая работа
Краткое описание БД - из каких таблиц и представлений состоит.
Таблицы:
самолеты

air_code - Код описан, IATA первичный ключ

модель - Модель представлена

диапазон - максимальная дальность полета, км

аэропорты

airport_code - Код аэропорта первичный ключ

airport_name - Название аэропорта

город - Город

долгота - Координаты аэропорта: долгота

широта - Координаты аэропорта: широта

часовой пояс - Временная зона аэропорта

посадочные талоны

ticket_no - Номер билета первичный ключ

Flight_id - Идентификатор рейса

boarding_no - Номер посадочного талона

seat_no - Номер места

заказы

book_ref - Рейтинг номеров первичный ключ

book_date - Дата бронирования

total_amount - Полная подборка

полеты

Flight_id - Идентификатор рейса первичный ключ

Flight_no - Номер рейса

Scheduled_departure - Время вылета по расписанию

Scheduled_arrival - Время прилёта по расписанию

отправление_аэропорт - Аэропорт отправления

прибытия_airport - Аэропорт встречи

статус - Статус рейса

air_code - Код описан, IATA

fact_departure - Фактическое время вылета

fact_arrival - Фактическое время прилёта

места

air_code - Код описан, IATA

seat_no - Номер места

fare_conditions - Класс обслуживания

Первичный ключ комплексный (1 и 2 поля)

ticket_flights

ticket_no - Номер билета

Flight_id - Идентификатор рейса

fare_conditions - Класс обслуживания

сумма - Стоимость перелета

Первичный ключ комплексный (1 и 2 поля)

Билеты

ticket_no - Номер билета первичный ключ

book_ref - Номера отелей

пассажир_ид - Идентификатор пассажира

passage_name - Имя пассажира

contact_data - Контактные данные пассажира

Представления:
рейсы_v

Flight_id

Номер рейса

запланированное_отправление

запланированное_отправление_местное

запланированное прибытие

запланированное_прибытие_местное

запланированная_длительность

аэропорт вылета

отправление_имя_аэропорта

Город отправления

прибытия_аэропорт

прибытие_имя_аэропорта

Город прибытия

статус

код_самолета

fact_departure

fact_departure_local

фактическое_прибытие

фактическое_прибытие_местное

фактическая_длительность

Мат.представления:
маршруты

Номер рейса

аэропорт вылета

отправление_имя_аэропорта

Город отправления

прибытия_аэропорт

прибытие_имя_аэропорта

Город прибытия

код_самолета

продолжительность

дни недели

Развернутый анализ БД - описания таблиц, логики, связей и бизнес-областей (частично можно взять базу данных, оформленную в виде анализа данных). Бизнес-задачи, которые можно решить, используя БД.
Таблица самолетов
Каждая модель воздушного судна идентифицируется своим трехзначным кодом (aircraft_code). Указывается также название модели (модель) и максимальная дальность полета в километрах (дальность полета).

Индексы:

ПЕРВИЧНЫЙ КЛЮЧ, btree (код_самолета)
Ограничения-проверки:

ПРОВЕРКА (диапазон > 0)
Ссылки извне:

ТАБЛИЦА "рейсы"
ЗАРУБЕЖНЫЙ КЛЮЧ (код_самолета) ССЫЛКИ самолеты(код_самолета) ТАБЛИЦА "места"
FOREIGN KEY (aircraft_code) ССЫЛКИ на самолеты (aircraft_code) НА УДАЛЕНИЕ КАСКАД
Таблица аэропортов
Аэропорт идентифицируется трехбуквенным кодом (airport_code) и имеет свое имя (airport_name).

Для города не предусмотрено специальное назначение, но название (город) используется и может служить для того, чтобы определить аэропорты одного города. Также используется ширина (долгота), долгота (широта) и часовой пояс (часовой пояс).

Индексы:

ПЕРВИЧНЫЙ КЛЮЧ, btree (код_аэропорта)
Ссылки извне:

ТАБЛИЦА "рейсы"
FOREIGN KEY (arrival_airport) REFERENCES аэропорты (airport_code)
FOREIGN KEY (departure_airport) REFERENCES аэропорты (airport_code)
Таблица boarding_passes
При регистрации на рейс, который возможен за сутки до плановой отправки, пассажиру выдается посадочный талон. Он идентифицируется также, как и перелет — номером билета и номером рейса.

Посадочным талонам присваиваются последовательные номера (boarding_no) в порядке регистрации пассажиров на рейсе (этот номер будет номером только в пределах данного рейса). В посадочном талоне питания номер места (seat_no).

Индексы:

ПЕРВИЧНЫЙ КЛЮЧ, btree (номер билета, идентификатор рейса)

УНИКАЛЬНОЕ ОГРАНИЧЕНИЕ, btree (flight_id, boarding_no)

УНИКАЛЬНОЕ ОГРАНИЧЕНИЕ, btree (flight_id, seat_no)

Ограничения внешнего ключа:

ЗАРУБЕЖНЫЙ КЛЮЧ (№ билета, идентификатор рейса) ССЫЛКИ ticket_flights (номер билета, идентификатор рейса)
Таблица бронирований
Пассажир заранее (book_date, максимальное за месяц до рейса) бронирует билеты себе и, возможно, подвержены чувству пассажиров. Бронирование идентифицирующим номером (book_ref, шестизначная комбинация букв и цифр).

Поле total_amount общей стоимости включенных в оформление перелетов всех пассажиров.

Индексы:

ПЕРВИЧНЫЙ КЛЮЧ, btree (book_ref)
Ссылки извне:

ТАБЛИЦА "билеты" ЗАРУБЕЖНЫЙ КЛЮЧ (book_ref) ССЫЛКИ бронирование(book_ref)
Таблица рейсов
Естественный ключ таблицы составлен из двух полей — номера рейса (flight_no) и даты отправления (scheduled_departure). Чтобы сделать внешние ключи на этом компактном компакт-диске, в качестве стандарта используется суррогатный ключ (flight_id).

Рейс всегда соединяется с двумя точками — аэропорты вылета (аэропорт отправления) и соединения (аэропорт прибытия). Такое предложение, как «рейс с пересадкой» отсутствует: если из аэропорта до другого нет прямого рейса, в билет просто включаются несколько типов рейсов.

У каждого рейса есть запланированные даты и время вылета (scheduled_departure) и сопряжение (scheduled_arrival). Реальное время вылета (фактическое_отправление) и сопряжение (фактическое_прибытие) может сравниться: обычно не сильно, но иногда и на несколько часов, если задержан задержан.

Статус приема (status) может быть однократно принят из следующих значений:

По расписанию Рейс доступен для поиска. Это происходит за месяц до плановой даты вылета; до этой записи о рейсе не существует в базе данных.

On Time Доступен для регистрации (за сутки до плановой даты вылета) и не задержан.

Delayed Рейс доступен для регистрации (за сутки до плановой даты вылета), но задержан.

Вылетел Самолет уже вылетел и находится на берегу.

Прибыл Самолет прибыл в пункт назначения.

Отменено

Индексы:

ПЕРВИЧНЫЙ КЛЮЧ, btree (flight_id) УНИКАЛЬНОЕ ОГРАНИЧЕНИЕ, btree (flight_no, schedule_departure)
Ограничения-проверки:

ПРОВЕРКА (запланированное_прибытие > запланированное_отправление)

ПРОВЕРИТЬ ((фактическое_прибытие IS NULL) ИЛИ ((фактическое_отправление НЕ НУЛЕВОЕ, И фактическое_прибытие НЕ НУЛЕВОЕ) И (фактическое_прибытие > фактическое_отправление)))

CHECK (статус IN («Вовремя», «Задержано», «Отправлено», «Прибыло», «Запланировано», «Отменено»)))

Ограничения внешнего ключа:

ЗАРУБЕЖНЫЙ КЛЮЧ (aircraft_code) ССЫЛКИ на самолеты (aircraft_code)

FOREIGN KEY (arrival_airport) REFERENCES аэропорты (airport_code)

FOREIGN KEY (departure_airport) REFERENCES аэропорты (airport_code)

Ссылки извне:

ТАБЛИЦА "ticket_flights" ВНЕШНИЙ КЛЮЧ (flight_id) ССЫЛКИ на рейсы (flight_id)
Таблица мест
Места определения схемы салона каждой модели. Установлено место определения своего номера (seat_no) и закрепленный за ним класс обслуживания (fare_conditions) — Эконом, Комфорт или Бизнес.

Индексы:

ПЕРВИЧНЫЙ КЛЮЧ, btree (код_самолета, номер_места)
Ограничения-проверки:

CHECK (fare_conditions IN ('Эконом', 'Комфорт', 'Бизнес'))
Ограничения внешнего ключа:

FOREIGN KEY (aircraft_code) ССЫЛКИ на самолеты (aircraft_code) НА УДАЛЕНИЕ КАСКАД
Таблица ticket_flights
Перелет соединяется с рейсом и идентифицируется их номерами.

Для каждого перелетает его стоимость (количество) и класс обслуживания (fare_conditions).

Индексы:

ПЕРВИЧНЫЙ КЛЮЧ, btree (номер билета, идентификатор рейса)
Ограничения-проверки:

ПРОВЕРКА (сумма >= 0)

CHECK (fare_conditions IN ('Эконом', 'Комфорт', 'Бизнес'))

Ограничения внешнего ключа:

ЗАРУБЕЖНЫЙ КЛЮЧ (flight_id) ССЫЛКИ на рейсы (flight_id)

ЗАРУБЕЖНЫЙ КЛЮЧ (номер билета) ССЫЛКИ билеты (номер билета)

Ссылки извне:

ТАБЛИЦА "boarding_passes" ИНОСТРАННЫЙ КЛЮЧ (ticket_no, Flight_id) ССЫЛКИ ticket_flights(ticket_no, Flight_id)
Билеты в таблице
Билет имеет действующий номер (ticket_no), накопленный из 13 цифр.

Билет содержит идентификатор пассажира (passenger_id) — номер документа, удостоверяющего личность, — его фамилию и имя (passenger_name) и контактную информацию (contact_date).

Ни идентификатора пассажира, ни идентификатора пассажира не являются паспортом (можно поменять, можно поменять фамилию), поэтому однозначно найти все билеты и одного пассажира невозможно.

Индексы:

ПЕРВИЧНЫЙ КЛЮЧ, btree (номер билета)
Ограничения внешнего ключа:

FOREIGN KEY (book_ref) ССЫЛКИ бронирование(book_ref)
Ссылки извне:

ТАБЛИЦА "ticket_flights" ЗАРУБЕЖНЫЙ КЛЮЧ (ticket_no) ССЫЛКИ Tickets(ticket_no)
Представление Flights_v
Над таблицей Flights создано представление Flights_v, содержащее дополнительную информацию:

расшифровку данных об аэропорте вылета (аэропорт отправления, название_аэропорта отправления, город отправления),

расшифровка данных об аэропорте (прибытие_аэропорт, прибытие_аэропорт_название, прибытие_город),

местное время вылета (scheduled_departure_local, fact_departure_local),

местное время отчета (scheduled_arrival_local, fact_arrival_local),

продолжительность выполнения (запланированная_длительность, фактическая_длительность).

Материализованное представление маршрутов
Таблица рейсов содержит избыточность: из нее можно было бы выделить информацию о маршруте (номер рейса, аэропорты отправления и назначения), которая не зависит от конкретных дат рейсов.

Именно такая информация и составляет материализованное представление маршрутов.

Столбец                 | Тип       | Описание
------------------------+-----------+-------------------------------------
flight_no               | char(6)   | Номер рейса
departure_airport       | char(3)   | Код аэропорта отправления
departure_airport_name  | text      | Название аэропорта отправления
departure_city          | text      | Город отправления
arrival_airport         | char(3)   | Код аэропорта прибытия
arrival_airport_name    | text      | Название аэропорта прибытия
arrival_city            | text      | Город прибытия
aircraft_code           | char(3)   | Код самолета, IATA
duration                | interval  | Продолжительность полета
days_of_week            | integer[] | Дни недели, когда выполняются рейсы`
Бизнес-задачи, которые можно решить, используя БД
множество вариантов вкусов кухни:

по направлениям,
по дням недели,
по классу обслуживания,
и т.п.

Данный пункт допускает использование отдельных рейсов с помощью объединения или исключения некоторых рейсов.

Получение результатов с задержкой вылета для изучения причин.

Получение данных для возврата денег за неиспользованные билеты.

Возможность развития новых интересующихся перелетов с помощью получения аэропортов, между регулярными рейсами.

Анализ нагрузки и подсчет полётных часов.

Список SQL-приложений из приложений №2 с описанием логики их выполнения.
Вышеприведенная ссылка на файл со всеми ссылками. Описание логики их выполнения дано в текстах комментариев перед каждым запросом.
